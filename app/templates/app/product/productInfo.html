{% extends "app/includes/base.html" %}

  {% block content %}

<!-- Main product container -->
<div class="dripspace-product-info">
  <!-- Product detail section -->
  <div class="product-detail-container">
    <!-- Product image section -->
    <div class="product-image-view">
      <div class="main-image-container">
        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="main-product-image">
        <div class="image-zoom-overlay"></div>
      </div>
      <div class="thumbnail-container">
        <div class="thumbnail active" data-image="{{ product.image.url }}">
          <img src="{{ product.image.url }}" alt="Thumbnail 1">
        </div>
        <!-- Additional thumbnails would come from ProductImage model if available -->
        {% for image in product.images.all %}
        <div class="thumbnail" data-image="{{ image.image.url }}">
          <img src="{{ image.image.url }}" alt="Thumbnail {{ forloop.counter|add:1 }}">
        </div>
        {% endfor %}
      </div>
    </div>
    
    <!-- Product information section -->
    <div class="product-info-block">
      <h1 class="product-title">{{ product.name }}</h1>
      <p class="product-price">Rs. {{ product.price }}</p>
      <p class="price-note">MRP inclusive of all taxes</p>
      
      <!-- Color selection -->
      <div class="color-selector">
        <h3 class="section-title">COLOUR</h3>
        <div class="color-options">
          <div class="color-option active" style="background-color: #8B4513;"></div>
          <div class="color-option" style="background-color: #2F4F4F;"></div>
          <div class="color-option" style="background-color: #696969;"></div>
          <div class="color-option" style="background-color: #D2691E;"></div>
        </div>
      </div>
      
      <!-- Size selection -->
      <div class="product-size-selector">
        <div class="size-header">
          <h3 class="section-title">SELECT SIZE</h3>
          <a href="#" class="size-guide-link">SIZE GUIDE</a>
        </div>
        
        <!-- Conditional rendering for footwear vs clothing sizes -->
        {% if product.is_footwear %}
        <!-- Shoe Size Selection -->
        <div class="size-options">
          {% for shoe_size in all_shoe_sizes %}
            {% if shoe_size in product.available_shoe_sizes.all %}
              <div class="size-option" data-size="{{ shoe_size.size }}" data-size-id="{{ shoe_size.id }}">{{ shoe_size.size }}</div>
            {% else %}
              <div class="size-option disabled" data-size="{{ shoe_size.size }}" data-size-id="{{ shoe_size.id }}">{{ shoe_size.size }}</div>
            {% endif %}
          {% endfor %}
        </div>
        {% else %}
        <!-- Clothing Size Selection -->
        <div class="size-options">
          {% for size in all_sizes %}
            {% if size in product.available_sizes.all %}
              <div class="size-option" data-size="{{ size.name }}" data-size-id="{{ size.id }}">{{ size.name }}</div>
            {% else %}
              <div class="size-option disabled" data-size="{{ size.name }}" data-size-id="{{ size.id }}">{{ size.name }}</div>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </div>
      
      <!-- Add to cart button -->
      <button class="dripspace-addcart-btn" id="addToCartBtn">ADD</button>
      
      <!-- Product description tabs -->
      <div class="info-tab-section">
        <div class="tab-content active" id="description">
          <p class="product-description" id="productDescription">
            {{ product.description|default:"This product has no description yet." }}
          </p>
          <a href="#" class="read-more-link" id="readMoreLink">Read More</a>
        </div>
        
        <!-- Replaced tabs with external links -->
        <div class="info-links">
          <a href="{% url 'careInstruction' %}" class="info-link">Product Care</a>
          <a href="{% url 'returnExchanges' %}" class="info-link">Delivery & Returns</a>
        </div>
        
        <!-- Removed product details tab content since it's now part of the main description -->
        <div class="tab-content" id="care" style="display: none;">
          <p>Machine wash cold with like colors. Tumble dry low. Do not bleach.</p>
        </div>
        
        <div class="tab-content" id="delivery" style="display: none;">
          <p>Free shipping on orders over Rs. 2000. Returns accepted within 30 days.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- More products section -->
  <div class="more-products-section">
    <h2 class="section-heading">MORE DRIPS</h2>
    <div class="product-grid">
      {% for related_product in related_products %}
      <div class="product-card">
        <div class="product-image-container">
          <img src="{{ related_product.image.url }}" alt="{{ related_product.name }}" class="product-image">
        </div>
        <div class="product-info">
          <h3 class="product-name">{{ related_product.name }}</h3>
          <p class="product-category">{{ related_product.category }}</p>
          <p class="product-price">Rs. {{ related_product.price }}</p>
          <a href="{% url 'productDetail' related_product.slug %}" class="view-product-btn">View Product</a>
        </div>
      </div>
      {% empty %}
      <p>No related products available.</p>
      {% endfor %}
    </div>
  </div>
</div>

<style>
/* Base styles and reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Helvetica Neue', Arial, sans-serif;
  color: #333;
  line-height: 1.4;
}

/* Main product container */
.dripspace-product-info {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* Product detail section - using CSS Grid for layout */
.product-detail-container {
  display: grid;
  grid-template-columns: 1fr;
  gap: 40px;
  margin-bottom: 60px;
}

/* Product image section */
.product-image-view {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.main-image-container {
  position: relative;
  width: 100%;
  max-width: 500px;
  overflow: hidden;
  margin-bottom: 20px;
}

.main-product-image {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.3s ease;
}

.image-zoom-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0);
  cursor: zoom-in;
  transition: background 0.3s ease;
}

.main-image-container.zoomed .image-zoom-overlay {
  cursor: zoom-out;
}

.main-image-container.zoomed .main-product-image {
  transform: scale(1.5);
}

.thumbnail-container {
  display: flex;
  gap: 10px;
}

.thumbnail {
  width: 80px;
  height: 80px;
  border: 1px solid #ddd;
  cursor: pointer;
  transition: border-color 0.2s ease;
}

.thumbnail.active {
  border-color: #000;
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Product information section */
.product-info-block {
  display: flex;
  flex-direction: column;
}

.product-title {
  font-size: 24px;
  font-weight: 600;
  text-transform: uppercase;
  margin-bottom: 10px;
  letter-spacing: 0.5px;
}

.product-price {
  font-size: 20px;
  font-weight: 500;
  margin-bottom: 5px;
}

.price-note {
  font-size: 12px;
  color: #666;
  margin-bottom: 25px;
}

.section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Color selector */
.color-options {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
}

.color-option {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  border: 1px solid #ddd;
}

.color-option.active {
  border-color: #000;
  box-shadow: 0 0 0 1px #000;
}

/* Size selector */
.product-size-selector {
  margin-bottom: 30px;
}

.size-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.size-guide-link {
  font-size: 12px;
  text-decoration: underline;
  color: #333;
}

.size-options {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.size-option {
  padding: 8px 16px;
  border: 1px solid #ddd;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.size-option:hover {
  border-color: #000;
}

.size-option.selected {
  background-color: #000;
  color: #fff;
  border-color: #000;
}

.size-option.disabled {
  background-color: #f5f5f5;
  color: #ccc;
  border-color: #eee;
  cursor: not-allowed;
}

.size-option.disabled:hover {
  border-color: #eee;
  background-color: #f5f5f5;
  color: #ccc;
}

/* Add to cart button */
.dripspace-addcart-btn {
  background-color: #000;
  color: #fff;
  border: none;
  padding: 14px 0;
  font-size: 16px;
  font-weight: 500;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 30px;
  letter-spacing: 0.5px;
}

.dripspace-addcart-btn:hover {
  background-color: #333;
}

.dripspace-addcart-btn.added {
  background-color: #4CAF50;
}

/* Info tab section */
.info-tab-section {
  border-top: 1px solid #eee;
  padding-top: 20px;
}

.tab-content {
  display: none;
  margin-bottom: 20px;
}

.tab-content.active {
  display: block;
}

.product-description {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 10px;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  position: relative;
}

.product-description.expanded {
  -webkit-line-clamp: unset;
  overflow: visible;
}

.read-more-link {
  font-size: 14px;
  text-decoration: underline;
  color: #333;
  display: none;
  cursor: pointer;
}

.read-more-link.show {
  display: inline-block;
}

.info-links {
  display: flex;
  gap: 20px;
  margin: 20px 0;
  border-top: 1px solid #eee;
  padding-top: 20px;
}

.info-link {
  font-size: 14px;
  text-decoration: underline;
  color: #333;
  cursor: pointer;
}

.info-link:hover {
  color: #000;
}

/* More products section */
.more-products-section {
  margin-top: 40px;
  padding-top: 30px;
  border-top: 1px solid #eee;
}

.section-heading {
  font-size: 24px;
  font-weight: 600;
  text-transform: uppercase;
  margin-bottom: 30px;
  letter-spacing: 1px;
  text-align: center;
  color: #111;
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
}

.product-card {
  display: flex;
  flex-direction: column;
  border: 1px solid #eee;
  transition: all 0.3s ease;
  background: #fff;
}

.product-card:hover {
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transform: translateY(-5px);
}

.product-image-container {
  width: 100%;
  overflow: hidden;
}

.product-image {
  width: 100%;
  height: 300px;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-card:hover .product-image {
  transform: scale(1.05);
}

.product-info {
  padding: 20px;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
}

.product-name {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 10px;
  color: #333;
  flex-grow: 1;
}

.product-category {
  font-size: 14px;
  color: #666;
  margin-bottom: 10px;
  text-transform: uppercase;
}

.product-price {
  font-size: 18px;
  font-weight: 500;
  color: #000;
  margin-bottom: 20px;
}

.view-product-btn {
  display: inline-block;
  background-color: #111;
  color: #fff;
  text-align: center;
  padding: 12px 0;
  text-decoration: none;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s ease;
  margin-top: auto;
  border: 1px solid #111;
}

.view-product-btn:hover {
  background-color: #fff;
  color: #111;
}

/* Responsive styles */
@media (min-width: 768px) {
  .product-detail-container {
    grid-template-columns: 1fr 1fr;
    gap: 60px;
  }
  
  .product-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}
</style>

<script>
// Use addEventListener instead of overriding window.onload to preserve existing functionality
window.addEventListener('load', function() {
  // Size selection functionality
  const sizeOptions = document.querySelectorAll('.size-option:not(.disabled)');
  let selectedSize = null;
  let selectedSizeId = null;
  
  sizeOptions.forEach(option => {
    option.addEventListener('click', function() {
      // Remove selected class from all size options
      sizeOptions.forEach(opt => opt.classList.remove('selected'));
      
      // Add selected class to clicked option
      this.classList.add('selected');
      
      // Store selected size
      selectedSize = this.getAttribute('data-size');
      selectedSizeId = this.getAttribute('data-size-id');
    });
  });
  
  // Add to cart functionality
  const addToCartBtn = document.getElementById('addToCartBtn');
  if (addToCartBtn) {
    addToCartBtn.addEventListener('click', function() {
      if (!selectedSize) {
        // Show notification to select size
        showToast('Please select a size before adding to cart');
        return;
      }
      
      // Check if product is footwear to determine which size field to use
      const isFootwear = {{ product.is_footwear|yesno:"true,false" }};
      
      // Prepare request data
      const requestData = {
        product_id: {{ product.id }},
        quantity: 1
      };
      
      // Add the appropriate size field based on product type
      if (isFootwear) {
        requestData.shoe_size_id = selectedSizeId;
      } else {
        requestData.size_id = selectedSizeId;
      }
      
      // Get CSRF token
      const csrftoken = getCookie('csrftoken');
      
      // Send AJAX request to add to cart
      fetch('{% url "add_to_cart" %}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken
        },
        body: JSON.stringify(requestData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showToast('Product added to cart successfully!');
          // Update cart count in navbar if possible
          const cartCountElement = document.querySelector('.cart-count');
          if (cartCountElement) {
            cartCountElement.textContent = data.cart_total_items;
          }
        } else {
          showToast('Error adding product to cart: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('Error adding product to cart');
      });
    });
  }
  
  // Thumbnail switching functionality
  const thumbnails = document.querySelectorAll('.thumbnail');
  const mainImage = document.querySelector('.main-product-image');
  
  thumbnails.forEach(thumbnail => {
    thumbnail.addEventListener('click', function() {
      // Remove active class from all thumbnails
      thumbnails.forEach(thumb => thumb.classList.remove('active'));
      
      // Add active class to clicked thumbnail
      this.classList.add('active');
      
      // Update main image
      const newImageSrc = this.getAttribute('data-image');
      mainImage.src = newImageSrc;
    });
  });
  
  // Read more functionality
  const description = document.getElementById('productDescription');
  const readMoreLink = document.getElementById('readMoreLink');
  
  if (description && readMoreLink) {
    // Check if description is long enough to need truncation
    if (description.scrollHeight > description.clientHeight) {
      readMoreLink.style.display = 'inline';
      
      readMoreLink.addEventListener('click', function(e) {
        e.preventDefault();
        description.classList.toggle('expanded');
        
        if (description.classList.contains('expanded')) {
          readMoreLink.textContent = 'Read Less';
        } else {
          readMoreLink.textContent = 'Read More';
        }
      });
    } else {
      readMoreLink.style.display = 'none';
    }
  }
  
  // Get cookie function
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  
  // Show toast notification
  function showToast(message) {
    // Create notification element
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: #dc2626;
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      font-weight: 500;
      z-index: 10000;
      animation: slideInRight 300ms ease-out;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    notification.textContent = message;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
      notification.style.animation = 'slideOutRight 300ms ease-in';
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, 3000);
  }
  
  // Add notification animations to CSS
  const notificationStyles = document.createElement('style');
  notificationStyles.textContent = `
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(notificationStyles);
});
</script>


{% endblock content %}